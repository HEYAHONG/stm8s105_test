                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 3.8.0 #10562 (Linux)
                                      4 ;--------------------------------------------------------
                                      5 	.module ds1302
                                      6 	.optsdcc -mstm8
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _ds1302_read
                                     12 	.globl _ds1302_write
                                     13 	.globl _ds1302_read_byte
                                     14 	.globl _ds1302_write_byte
                                     15 	.globl _write_IO
                                     16 	.globl _read_IO
                                     17 	.globl _delay_us
                                     18 	.globl _GPIO_ReadInputPin
                                     19 	.globl _GPIO_WriteLow
                                     20 	.globl _GPIO_WriteHigh
                                     21 	.globl _GPIO_Init
                                     22 	.globl _ds1302_port_deinit
                                     23 	.globl _ds1302_port_init
                                     24 	.globl _ds1302_check
                                     25 	.globl _ds1302_read_time
                                     26 	.globl _ds1302_write_time
                                     27 	.globl _ds1302_write_ram
                                     28 	.globl _ds1302_read_ram
                                     29 ;--------------------------------------------------------
                                     30 ; ram data
                                     31 ;--------------------------------------------------------
                                     32 	.area DATA
                                     33 ;--------------------------------------------------------
                                     34 ; ram data
                                     35 ;--------------------------------------------------------
                                     36 	.area INITIALIZED
                                     37 ;--------------------------------------------------------
                                     38 ; absolute external ram data
                                     39 ;--------------------------------------------------------
                                     40 	.area DABS (ABS)
                                     41 
                                     42 ; default segment ordering for linker
                                     43 	.area HOME
                                     44 	.area GSINIT
                                     45 	.area GSFINAL
                                     46 	.area CONST
                                     47 	.area INITIALIZER
                                     48 	.area CODE
                                     49 
                                     50 ;--------------------------------------------------------
                                     51 ; global & static initialisations
                                     52 ;--------------------------------------------------------
                                     53 	.area HOME
                                     54 	.area GSINIT
                                     55 	.area GSFINAL
                                     56 	.area GSINIT
                                     57 ;--------------------------------------------------------
                                     58 ; Home
                                     59 ;--------------------------------------------------------
                                     60 	.area HOME
                                     61 	.area HOME
                                     62 ;--------------------------------------------------------
                                     63 ; code
                                     64 ;--------------------------------------------------------
                                     65 	.area CODE
                                     66 ;	driver/ds1302.c: 6: void delay_us(unsigned int xx)
                                     67 ;	-----------------------------------------
                                     68 ;	 function delay_us
                                     69 ;	-----------------------------------------
      008863                         70 _delay_us:
                                     71 ;	driver/ds1302.c: 15: nop();
      008863 16 03            [ 2]   72 	ldw	y, (0x03, sp)
      008865                         73 00108$:
                                     74 ;	driver/ds1302.c: 9: for(;xx>0;xx--)
      008865 90 5D            [ 2]   75 	tnzw	y
      008867 27 0C            [ 1]   76 	jreq	00121$
                                     77 ;	driver/ds1302.c: 11: for(yy = 0;yy<4;yy++)
      008869 AE 00 04         [ 2]   78 	ldw	x, #0x0004
      00886C                         79 00106$:
                                     80 ;	driver/ds1302.c: 12: nop();
      00886C 9D               [ 1]   81 	nop
      00886D 5A               [ 2]   82 	decw	x
                                     83 ;	driver/ds1302.c: 11: for(yy = 0;yy<4;yy++)
      00886E 5D               [ 2]   84 	tnzw	x
      00886F 26 FB            [ 1]   85 	jrne	00106$
                                     86 ;	driver/ds1302.c: 9: for(;xx>0;xx--)
      008871 90 5A            [ 2]   87 	decw	y
      008873 20 F0            [ 2]   88 	jra	00108$
                                     89 ;	driver/ds1302.c: 14: for(yy = 0;yy<1;yy++)
      008875                         90 00121$:
      008875 5F               [ 1]   91 	clrw	x
      008876 5C               [ 1]   92 	incw	x
      008877                         93 00112$:
                                     94 ;	driver/ds1302.c: 15: nop();
      008877 9D               [ 1]   95 	nop
      008878 5A               [ 2]   96 	decw	x
                                     97 ;	driver/ds1302.c: 14: for(yy = 0;yy<1;yy++)
      008879 5D               [ 2]   98 	tnzw	x
      00887A 26 FB            [ 1]   99 	jrne	00112$
                                    100 ;	driver/ds1302.c: 16: nop();
      00887C 9D               [ 1]  101 	nop
                                    102 ;	driver/ds1302.c: 17: nop();
      00887D 9D               [ 1]  103 	nop
                                    104 ;	driver/ds1302.c: 18: nop();
      00887E 9D               [ 1]  105 	nop
                                    106 ;	driver/ds1302.c: 19: nop();
      00887F 9D               [ 1]  107 	nop
                                    108 ;	driver/ds1302.c: 20: nop();
      008880 9D               [ 1]  109 	nop
                                    110 ;	driver/ds1302.c: 21: nop();
      008881 9D               [ 1]  111 	nop
                                    112 ;	driver/ds1302.c: 22: }
      008882 81               [ 4]  113 	ret
                                    114 ;	driver/ds1302.c: 25: void ds1302_port_deinit(void)
                                    115 ;	-----------------------------------------
                                    116 ;	 function ds1302_port_deinit
                                    117 ;	-----------------------------------------
      008883                        118 _ds1302_port_deinit:
                                    119 ;	driver/ds1302.c: 27: GPIO_Init(DS1302_PORT,DS1302_CLK_PIN, GPIO_Mode_In_FL_No_IT);//RTC_CLK
      008883 4B 40            [ 1]  120 	push	#0x40
      008885 4B 08            [ 1]  121 	push	#0x08
      008887 4B 05            [ 1]  122 	push	#0x05
      008889 4B 50            [ 1]  123 	push	#0x50
      00888B CD 90 0E         [ 4]  124 	call	_GPIO_Init
      00888E 5B 04            [ 2]  125 	addw	sp, #4
                                    126 ;	driver/ds1302.c: 28: GPIO_Init(DS1302_PORT_RST,DS1302_RST_PIN, GPIO_Mode_In_FL_No_IT);//        
      008890 4B 40            [ 1]  127 	push	#0x40
      008892 4B 02            [ 1]  128 	push	#0x02
      008894 4B 05            [ 1]  129 	push	#0x05
      008896 4B 50            [ 1]  130 	push	#0x50
      008898 CD 90 0E         [ 4]  131 	call	_GPIO_Init
      00889B 5B 04            [ 2]  132 	addw	sp, #4
                                    133 ;	driver/ds1302.c: 29: GPIO_Init(DS1302_PORT,DS1302_IO_PIN, GPIO_Mode_In_FL_No_IT);      //RTC_DATA   
      00889D 4B 40            [ 1]  134 	push	#0x40
      00889F 4B 04            [ 1]  135 	push	#0x04
      0088A1 4B 05            [ 1]  136 	push	#0x05
      0088A3 4B 50            [ 1]  137 	push	#0x50
      0088A5 CD 90 0E         [ 4]  138 	call	_GPIO_Init
      0088A8 5B 04            [ 2]  139 	addw	sp, #4
                                    140 ;	driver/ds1302.c: 31: }
      0088AA 81               [ 4]  141 	ret
                                    142 ;	driver/ds1302.c: 33: void ds1302_port_init(void)
                                    143 ;	-----------------------------------------
                                    144 ;	 function ds1302_port_init
                                    145 ;	-----------------------------------------
      0088AB                        146 _ds1302_port_init:
                                    147 ;	driver/ds1302.c: 35: GPIO_Init(DS1302_PORT,DS1302_CLK_PIN, GPIO_MODE_OUT_PP_HIGH_FAST);//RTC_CLK
      0088AB 4B F0            [ 1]  148 	push	#0xf0
      0088AD 4B 08            [ 1]  149 	push	#0x08
      0088AF 4B 05            [ 1]  150 	push	#0x05
      0088B1 4B 50            [ 1]  151 	push	#0x50
      0088B3 CD 90 0E         [ 4]  152 	call	_GPIO_Init
      0088B6 5B 04            [ 2]  153 	addw	sp, #4
                                    154 ;	driver/ds1302.c: 36: GPIO_Init(DS1302_PORT_RST,DS1302_RST_PIN, GPIO_MODE_OUT_PP_HIGH_FAST);//        
      0088B8 4B F0            [ 1]  155 	push	#0xf0
      0088BA 4B 02            [ 1]  156 	push	#0x02
      0088BC 4B 05            [ 1]  157 	push	#0x05
      0088BE 4B 50            [ 1]  158 	push	#0x50
      0088C0 CD 90 0E         [ 4]  159 	call	_GPIO_Init
      0088C3 5B 04            [ 2]  160 	addw	sp, #4
                                    161 ;	driver/ds1302.c: 37: GPIO_Init(DS1302_PORT,DS1302_IO_PIN, GPIO_MODE_IN_PU_NO_IT);      //RTC_DATA   
      0088C5 4B 40            [ 1]  162 	push	#0x40
      0088C7 4B 04            [ 1]  163 	push	#0x04
      0088C9 4B 05            [ 1]  164 	push	#0x05
      0088CB 4B 50            [ 1]  165 	push	#0x50
      0088CD CD 90 0E         [ 4]  166 	call	_GPIO_Init
      0088D0 5B 04            [ 2]  167 	addw	sp, #4
                                    168 ;	driver/ds1302.c: 39: GPIO_LOW(DS1302_PORT_RST,DS1302_RST_PIN); 
      0088D2 4B 02            [ 1]  169 	push	#0x02
      0088D4 4B 05            [ 1]  170 	push	#0x05
      0088D6 4B 50            [ 1]  171 	push	#0x50
      0088D8 CD 90 90         [ 4]  172 	call	_GPIO_WriteLow
      0088DB 5B 03            [ 2]  173 	addw	sp, #3
                                    174 ;	driver/ds1302.c: 40: GPIO_LOW(DS1302_PORT,DS1302_CLK_PIN); 
      0088DD 4B 08            [ 1]  175 	push	#0x08
      0088DF 4B 05            [ 1]  176 	push	#0x05
      0088E1 4B 50            [ 1]  177 	push	#0x50
      0088E3 CD 90 90         [ 4]  178 	call	_GPIO_WriteLow
      0088E6 5B 03            [ 2]  179 	addw	sp, #3
                                    180 ;	driver/ds1302.c: 48: }
      0088E8 81               [ 4]  181 	ret
                                    182 ;	driver/ds1302.c: 50: void read_IO(void){
                                    183 ;	-----------------------------------------
                                    184 ;	 function read_IO
                                    185 ;	-----------------------------------------
      0088E9                        186 _read_IO:
                                    187 ;	driver/ds1302.c: 51: GPIO_Init(DS1302_PORT,DS1302_IO_PIN, GPIO_MODE_IN_PU_NO_IT);   //RTC_DATA        
      0088E9 4B 40            [ 1]  188 	push	#0x40
      0088EB 4B 04            [ 1]  189 	push	#0x04
      0088ED 4B 05            [ 1]  190 	push	#0x05
      0088EF 4B 50            [ 1]  191 	push	#0x50
      0088F1 CD 90 0E         [ 4]  192 	call	_GPIO_Init
      0088F4 5B 04            [ 2]  193 	addw	sp, #4
                                    194 ;	driver/ds1302.c: 52: }
      0088F6 81               [ 4]  195 	ret
                                    196 ;	driver/ds1302.c: 54: void write_IO(void){ 
                                    197 ;	-----------------------------------------
                                    198 ;	 function write_IO
                                    199 ;	-----------------------------------------
      0088F7                        200 _write_IO:
                                    201 ;	driver/ds1302.c: 55: GPIO_Init(DS1302_PORT,DS1302_IO_PIN, GPIO_MODE_OUT_PP_HIGH_FAST);//RTC_DATA
      0088F7 4B F0            [ 1]  202 	push	#0xf0
      0088F9 4B 04            [ 1]  203 	push	#0x04
      0088FB 4B 05            [ 1]  204 	push	#0x05
      0088FD 4B 50            [ 1]  205 	push	#0x50
      0088FF CD 90 0E         [ 4]  206 	call	_GPIO_Init
      008902 5B 04            [ 2]  207 	addw	sp, #4
                                    208 ;	driver/ds1302.c: 56: }
      008904 81               [ 4]  209 	ret
                                    210 ;	driver/ds1302.c: 59: void ds1302_write_byte(unsigned char temp) 
                                    211 ;	-----------------------------------------
                                    212 ;	 function ds1302_write_byte
                                    213 ;	-----------------------------------------
      008905                        214 _ds1302_write_byte:
      008905 88               [ 1]  215 	push	a
                                    216 ;	driver/ds1302.c: 62: for (i=0;i<8;i++)     
      008906 0F 01            [ 1]  217 	clr	(0x01, sp)
      008908                        218 00105$:
                                    219 ;	driver/ds1302.c: 64: GPIO_LOW(DS1302_PORT,DS1302_CLK_PIN);
      008908 4B 08            [ 1]  220 	push	#0x08
      00890A 4B 05            [ 1]  221 	push	#0x05
      00890C 4B 50            [ 1]  222 	push	#0x50
      00890E CD 90 90         [ 4]  223 	call	_GPIO_WriteLow
      008911 5B 03            [ 2]  224 	addw	sp, #3
                                    225 ;	driver/ds1302.c: 66: if(temp&0x01) {
      008913 7B 04            [ 1]  226 	ld	a, (0x04, sp)
      008915 44               [ 1]  227 	srl	a
      008916 24 0D            [ 1]  228 	jrnc	00102$
                                    229 ;	driver/ds1302.c: 67: GPIO_HIGH(DS1302_PORT,DS1302_IO_PIN); 
      008918 4B 04            [ 1]  230 	push	#0x04
      00891A 4B 05            [ 1]  231 	push	#0x05
      00891C 4B 50            [ 1]  232 	push	#0x50
      00891E CD 90 89         [ 4]  233 	call	_GPIO_WriteHigh
      008921 5B 03            [ 2]  234 	addw	sp, #3
      008923 20 0B            [ 2]  235 	jra	00103$
      008925                        236 00102$:
                                    237 ;	driver/ds1302.c: 69: GPIO_LOW(DS1302_PORT,DS1302_IO_PIN);
      008925 4B 04            [ 1]  238 	push	#0x04
      008927 4B 05            [ 1]  239 	push	#0x05
      008929 4B 50            [ 1]  240 	push	#0x50
      00892B CD 90 90         [ 4]  241 	call	_GPIO_WriteLow
      00892E 5B 03            [ 2]  242 	addw	sp, #3
      008930                        243 00103$:
                                    244 ;	driver/ds1302.c: 71: temp>>=1; 
      008930 04 04            [ 1]  245 	srl	(0x04, sp)
                                    246 ;	driver/ds1302.c: 72: delay_us(1);
      008932 4B 01            [ 1]  247 	push	#0x01
      008934 4B 00            [ 1]  248 	push	#0x00
      008936 CD 88 63         [ 4]  249 	call	_delay_us
      008939 5B 02            [ 2]  250 	addw	sp, #2
                                    251 ;	driver/ds1302.c: 73: GPIO_HIGH(DS1302_PORT,DS1302_CLK_PIN); 
      00893B 4B 08            [ 1]  252 	push	#0x08
      00893D 4B 05            [ 1]  253 	push	#0x05
      00893F 4B 50            [ 1]  254 	push	#0x50
      008941 CD 90 89         [ 4]  255 	call	_GPIO_WriteHigh
      008944 5B 03            [ 2]  256 	addw	sp, #3
                                    257 ;	driver/ds1302.c: 62: for (i=0;i<8;i++)     
      008946 0C 01            [ 1]  258 	inc	(0x01, sp)
      008948 7B 01            [ 1]  259 	ld	a, (0x01, sp)
      00894A A1 08            [ 1]  260 	cp	a, #0x08
      00894C 25 BA            [ 1]  261 	jrc	00105$
                                    262 ;	driver/ds1302.c: 76: }  
      00894E 84               [ 1]  263 	pop	a
      00894F 81               [ 4]  264 	ret
                                    265 ;	driver/ds1302.c: 77: unsigned char ds1302_read_byte(void) 
                                    266 ;	-----------------------------------------
                                    267 ;	 function ds1302_read_byte
                                    268 ;	-----------------------------------------
      008950                        269 _ds1302_read_byte:
      008950 52 02            [ 2]  270 	sub	sp, #2
                                    271 ;	driver/ds1302.c: 79: unsigned char i,temp=0;
      008952 0F 01            [ 1]  272 	clr	(0x01, sp)
                                    273 ;	driver/ds1302.c: 80: for (i=0;i<8;i++) 		
      008954 0F 02            [ 1]  274 	clr	(0x02, sp)
      008956                        275 00104$:
                                    276 ;	driver/ds1302.c: 82: GPIO_LOW(DS1302_PORT,DS1302_CLK_PIN);
      008956 4B 08            [ 1]  277 	push	#0x08
      008958 4B 05            [ 1]  278 	push	#0x05
      00895A 4B 50            [ 1]  279 	push	#0x50
      00895C CD 90 90         [ 4]  280 	call	_GPIO_WriteLow
      00895F 5B 03            [ 2]  281 	addw	sp, #3
                                    282 ;	driver/ds1302.c: 83: temp>>=1;
      008961 7B 01            [ 1]  283 	ld	a, (0x01, sp)
      008963 44               [ 1]  284 	srl	a
      008964 6B 01            [ 1]  285 	ld	(0x01, sp), a
                                    286 ;	driver/ds1302.c: 84: if(GPIO_ReadInputDataBit(DS1302_PORT,DS1302_IO_PIN))
      008966 4B 04            [ 1]  287 	push	#0x04
      008968 4B 05            [ 1]  288 	push	#0x05
      00896A 4B 50            [ 1]  289 	push	#0x50
      00896C CD 90 AE         [ 4]  290 	call	_GPIO_ReadInputPin
      00896F 5B 03            [ 2]  291 	addw	sp, #3
      008971 4D               [ 1]  292 	tnz	a
      008972 27 06            [ 1]  293 	jreq	00102$
                                    294 ;	driver/ds1302.c: 86: temp|=0x80;	
      008974 7B 01            [ 1]  295 	ld	a, (0x01, sp)
      008976 AA 80            [ 1]  296 	or	a, #0x80
      008978 6B 01            [ 1]  297 	ld	(0x01, sp), a
      00897A                        298 00102$:
                                    299 ;	driver/ds1302.c: 88: delay_us(1);
      00897A 4B 01            [ 1]  300 	push	#0x01
      00897C 4B 00            [ 1]  301 	push	#0x00
      00897E CD 88 63         [ 4]  302 	call	_delay_us
      008981 5B 02            [ 2]  303 	addw	sp, #2
                                    304 ;	driver/ds1302.c: 89: GPIO_HIGH(DS1302_PORT,DS1302_CLK_PIN); 
      008983 4B 08            [ 1]  305 	push	#0x08
      008985 4B 05            [ 1]  306 	push	#0x05
      008987 4B 50            [ 1]  307 	push	#0x50
      008989 CD 90 89         [ 4]  308 	call	_GPIO_WriteHigh
      00898C 5B 03            [ 2]  309 	addw	sp, #3
                                    310 ;	driver/ds1302.c: 80: for (i=0;i<8;i++) 		
      00898E 0C 02            [ 1]  311 	inc	(0x02, sp)
      008990 7B 02            [ 1]  312 	ld	a, (0x02, sp)
      008992 A1 08            [ 1]  313 	cp	a, #0x08
      008994 25 C0            [ 1]  314 	jrc	00104$
                                    315 ;	driver/ds1302.c: 93: return temp;
      008996 7B 01            [ 1]  316 	ld	a, (0x01, sp)
                                    317 ;	driver/ds1302.c: 94: } 
      008998 5B 02            [ 2]  318 	addw	sp, #2
      00899A 81               [ 4]  319 	ret
                                    320 ;	driver/ds1302.c: 96: void ds1302_write( unsigned char address,unsigned char dat )     
                                    321 ;	-----------------------------------------
                                    322 ;	 function ds1302_write
                                    323 ;	-----------------------------------------
      00899B                        324 _ds1302_write:
                                    325 ;	driver/ds1302.c: 98: write_IO();
      00899B CD 88 F7         [ 4]  326 	call	_write_IO
                                    327 ;	driver/ds1302.c: 99: GPIO_LOW(DS1302_PORT_RST,DS1302_RST_PIN);   //写地址，写数据 RST保持高电平
      00899E 4B 02            [ 1]  328 	push	#0x02
      0089A0 4B 05            [ 1]  329 	push	#0x05
      0089A2 4B 50            [ 1]  330 	push	#0x50
      0089A4 CD 90 90         [ 4]  331 	call	_GPIO_WriteLow
      0089A7 5B 03            [ 2]  332 	addw	sp, #3
                                    333 ;	driver/ds1302.c: 100: GPIO_LOW(DS1302_PORT,DS1302_CLK_PIN);
      0089A9 4B 08            [ 1]  334 	push	#0x08
      0089AB 4B 05            [ 1]  335 	push	#0x05
      0089AD 4B 50            [ 1]  336 	push	#0x50
      0089AF CD 90 90         [ 4]  337 	call	_GPIO_WriteLow
      0089B2 5B 03            [ 2]  338 	addw	sp, #3
                                    339 ;	driver/ds1302.c: 101: GPIO_HIGH(DS1302_PORT_RST,DS1302_RST_PIN);
      0089B4 4B 02            [ 1]  340 	push	#0x02
      0089B6 4B 05            [ 1]  341 	push	#0x05
      0089B8 4B 50            [ 1]  342 	push	#0x50
      0089BA CD 90 89         [ 4]  343 	call	_GPIO_WriteHigh
      0089BD 5B 03            [ 2]  344 	addw	sp, #3
                                    345 ;	driver/ds1302.c: 102: ds1302_write_byte(address);	
      0089BF 7B 03            [ 1]  346 	ld	a, (0x03, sp)
      0089C1 88               [ 1]  347 	push	a
      0089C2 CD 89 05         [ 4]  348 	call	_ds1302_write_byte
      0089C5 84               [ 1]  349 	pop	a
                                    350 ;	driver/ds1302.c: 103: ds1302_write_byte(dat);		
      0089C6 7B 04            [ 1]  351 	ld	a, (0x04, sp)
      0089C8 88               [ 1]  352 	push	a
      0089C9 CD 89 05         [ 4]  353 	call	_ds1302_write_byte
      0089CC 84               [ 1]  354 	pop	a
                                    355 ;	driver/ds1302.c: 104: GPIO_LOW(DS1302_PORT_RST,DS1302_RST_PIN);
      0089CD 4B 02            [ 1]  356 	push	#0x02
      0089CF 4B 05            [ 1]  357 	push	#0x05
      0089D1 4B 50            [ 1]  358 	push	#0x50
      0089D3 CD 90 90         [ 4]  359 	call	_GPIO_WriteLow
      0089D6 5B 03            [ 2]  360 	addw	sp, #3
                                    361 ;	driver/ds1302.c: 106: }
      0089D8 81               [ 4]  362 	ret
                                    363 ;	driver/ds1302.c: 108: unsigned char ds1302_read( unsigned char address )
                                    364 ;	-----------------------------------------
                                    365 ;	 function ds1302_read
                                    366 ;	-----------------------------------------
      0089D9                        367 _ds1302_read:
                                    368 ;	driver/ds1302.c: 111: write_IO();
      0089D9 CD 88 F7         [ 4]  369 	call	_write_IO
                                    370 ;	driver/ds1302.c: 112: GPIO_LOW(DS1302_PORT_RST,DS1302_RST_PIN);
      0089DC 4B 02            [ 1]  371 	push	#0x02
      0089DE 4B 05            [ 1]  372 	push	#0x05
      0089E0 4B 50            [ 1]  373 	push	#0x50
      0089E2 CD 90 90         [ 4]  374 	call	_GPIO_WriteLow
      0089E5 5B 03            [ 2]  375 	addw	sp, #3
                                    376 ;	driver/ds1302.c: 113: GPIO_LOW(DS1302_PORT,DS1302_CLK_PIN);
      0089E7 4B 08            [ 1]  377 	push	#0x08
      0089E9 4B 05            [ 1]  378 	push	#0x05
      0089EB 4B 50            [ 1]  379 	push	#0x50
      0089ED CD 90 90         [ 4]  380 	call	_GPIO_WriteLow
      0089F0 5B 03            [ 2]  381 	addw	sp, #3
                                    382 ;	driver/ds1302.c: 114: GPIO_HIGH(DS1302_PORT_RST,DS1302_RST_PIN);
      0089F2 4B 02            [ 1]  383 	push	#0x02
      0089F4 4B 05            [ 1]  384 	push	#0x05
      0089F6 4B 50            [ 1]  385 	push	#0x50
      0089F8 CD 90 89         [ 4]  386 	call	_GPIO_WriteHigh
      0089FB 5B 03            [ 2]  387 	addw	sp, #3
                                    388 ;	driver/ds1302.c: 115: ds1302_write_byte(address|0x01);  //读标志：地址最后一位为1
      0089FD 7B 03            [ 1]  389 	ld	a, (0x03, sp)
      0089FF AA 01            [ 1]  390 	or	a, #0x01
      008A01 88               [ 1]  391 	push	a
      008A02 CD 89 05         [ 4]  392 	call	_ds1302_write_byte
      008A05 84               [ 1]  393 	pop	a
                                    394 ;	driver/ds1302.c: 116: read_IO();
      008A06 CD 88 E9         [ 4]  395 	call	_read_IO
                                    396 ;	driver/ds1302.c: 117: ret = ds1302_read_byte();
      008A09 CD 89 50         [ 4]  397 	call	_ds1302_read_byte
                                    398 ;	driver/ds1302.c: 118: GPIO_LOW(DS1302_PORT_RST,DS1302_RST_PIN);
      008A0C 88               [ 1]  399 	push	a
      008A0D 4B 02            [ 1]  400 	push	#0x02
      008A0F 4B 05            [ 1]  401 	push	#0x05
      008A11 4B 50            [ 1]  402 	push	#0x50
      008A13 CD 90 90         [ 4]  403 	call	_GPIO_WriteLow
      008A16 5B 03            [ 2]  404 	addw	sp, #3
      008A18 84               [ 1]  405 	pop	a
                                    406 ;	driver/ds1302.c: 119: return (ret);		
                                    407 ;	driver/ds1302.c: 120: }	
      008A19 81               [ 4]  408 	ret
                                    409 ;	driver/ds1302.c: 122: unsigned char ds1302_check(void) 
                                    410 ;	-----------------------------------------
                                    411 ;	 function ds1302_check
                                    412 ;	-----------------------------------------
      008A1A                        413 _ds1302_check:
                                    414 ;	driver/ds1302.c: 125: ds1302_write(DS1302_CONTROL_REG,0x80); 
      008A1A 4B 80            [ 1]  415 	push	#0x80
      008A1C 4B 8E            [ 1]  416 	push	#0x8e
      008A1E CD 89 9B         [ 4]  417 	call	_ds1302_write
      008A21 5B 02            [ 2]  418 	addw	sp, #2
                                    419 ;	driver/ds1302.c: 126: ret = ds1302_read(DS1302_CONTROL_REG);
      008A23 4B 8E            [ 1]  420 	push	#0x8e
      008A25 CD 89 D9         [ 4]  421 	call	_ds1302_read
      008A28 5B 01            [ 2]  422 	addw	sp, #1
                                    423 ;	driver/ds1302.c: 127: if(ret==0x80)
                                    424 ;	driver/ds1302.c: 128: return 1; 
      008A2A A0 80            [ 1]  425 	sub	a, #0x80
      008A2C 26 02            [ 1]  426 	jrne	00102$
      008A2E 4C               [ 1]  427 	inc	a
      008A2F 81               [ 4]  428 	ret
      008A30                        429 00102$:
                                    430 ;	driver/ds1302.c: 129: return 0; 
      008A30 4F               [ 1]  431 	clr	a
                                    432 ;	driver/ds1302.c: 130: }
      008A31 81               [ 4]  433 	ret
                                    434 ;	driver/ds1302.c: 132: void ds1302_read_time(DS1302_TIME* time) 
                                    435 ;	-----------------------------------------
                                    436 ;	 function ds1302_read_time
                                    437 ;	-----------------------------------------
      008A32                        438 _ds1302_read_time:
      008A32 52 02            [ 2]  439 	sub	sp, #2
                                    440 ;	driver/ds1302.c: 134: time->year=ds1302_read(DS1302_YEAR_REG); //年 
      008A34 16 05            [ 2]  441 	ldw	y, (0x05, sp)
      008A36 17 01            [ 2]  442 	ldw	(0x01, sp), y
      008A38 4B 8C            [ 1]  443 	push	#0x8c
      008A3A CD 89 D9         [ 4]  444 	call	_ds1302_read
      008A3D 5B 01            [ 2]  445 	addw	sp, #1
      008A3F 1E 01            [ 2]  446 	ldw	x, (0x01, sp)
      008A41 F7               [ 1]  447 	ld	(x), a
                                    448 ;	driver/ds1302.c: 135: time->month=ds1302_read(DS1302_MONTH_REG);//月 
      008A42 1E 01            [ 2]  449 	ldw	x, (0x01, sp)
      008A44 5C               [ 1]  450 	incw	x
      008A45 89               [ 2]  451 	pushw	x
      008A46 4B 88            [ 1]  452 	push	#0x88
      008A48 CD 89 D9         [ 4]  453 	call	_ds1302_read
      008A4B 5B 01            [ 2]  454 	addw	sp, #1
      008A4D 85               [ 2]  455 	popw	x
      008A4E F7               [ 1]  456 	ld	(x), a
                                    457 ;	driver/ds1302.c: 136: time->day=ds1302_read(DS1302_DATE_REG); //日 
      008A4F 1E 01            [ 2]  458 	ldw	x, (0x01, sp)
      008A51 5C               [ 1]  459 	incw	x
      008A52 5C               [ 1]  460 	incw	x
      008A53 89               [ 2]  461 	pushw	x
      008A54 4B 86            [ 1]  462 	push	#0x86
      008A56 CD 89 D9         [ 4]  463 	call	_ds1302_read
      008A59 5B 01            [ 2]  464 	addw	sp, #1
      008A5B 85               [ 2]  465 	popw	x
      008A5C F7               [ 1]  466 	ld	(x), a
                                    467 ;	driver/ds1302.c: 137: time->week=ds1302_read(DS1302_DAY_REG); //周 
      008A5D 1E 01            [ 2]  468 	ldw	x, (0x01, sp)
      008A5F 1C 00 03         [ 2]  469 	addw	x, #0x0003
      008A62 89               [ 2]  470 	pushw	x
      008A63 4B 8A            [ 1]  471 	push	#0x8a
      008A65 CD 89 D9         [ 4]  472 	call	_ds1302_read
      008A68 5B 01            [ 2]  473 	addw	sp, #1
      008A6A 85               [ 2]  474 	popw	x
      008A6B F7               [ 1]  475 	ld	(x), a
                                    476 ;	driver/ds1302.c: 138: time->hour=ds1302_read(DS1302_HR_REG); //时 
      008A6C 1E 01            [ 2]  477 	ldw	x, (0x01, sp)
      008A6E 1C 00 04         [ 2]  478 	addw	x, #0x0004
      008A71 89               [ 2]  479 	pushw	x
      008A72 4B 84            [ 1]  480 	push	#0x84
      008A74 CD 89 D9         [ 4]  481 	call	_ds1302_read
      008A77 5B 01            [ 2]  482 	addw	sp, #1
      008A79 85               [ 2]  483 	popw	x
      008A7A F7               [ 1]  484 	ld	(x), a
                                    485 ;	driver/ds1302.c: 139: time->minute=ds1302_read(DS1302_MIN_REG); //分 
      008A7B 1E 01            [ 2]  486 	ldw	x, (0x01, sp)
      008A7D 1C 00 05         [ 2]  487 	addw	x, #0x0005
      008A80 89               [ 2]  488 	pushw	x
      008A81 4B 82            [ 1]  489 	push	#0x82
      008A83 CD 89 D9         [ 4]  490 	call	_ds1302_read
      008A86 5B 01            [ 2]  491 	addw	sp, #1
      008A88 85               [ 2]  492 	popw	x
      008A89 F7               [ 1]  493 	ld	(x), a
                                    494 ;	driver/ds1302.c: 140: time->second=ds1302_read(DS1302_SEC_REG); //秒 
      008A8A 1E 01            [ 2]  495 	ldw	x, (0x01, sp)
      008A8C 1C 00 06         [ 2]  496 	addw	x, #0x0006
      008A8F 89               [ 2]  497 	pushw	x
      008A90 4B 80            [ 1]  498 	push	#0x80
      008A92 CD 89 D9         [ 4]  499 	call	_ds1302_read
      008A95 5B 01            [ 2]  500 	addw	sp, #1
      008A97 85               [ 2]  501 	popw	x
      008A98 F7               [ 1]  502 	ld	(x), a
                                    503 ;	driver/ds1302.c: 146: } 
      008A99 5B 02            [ 2]  504 	addw	sp, #2
      008A9B 81               [ 4]  505 	ret
                                    506 ;	driver/ds1302.c: 147: void ds1302_write_time(DS1302_TIME* time) 
                                    507 ;	-----------------------------------------
                                    508 ;	 function ds1302_write_time
                                    509 ;	-----------------------------------------
      008A9C                        510 _ds1302_write_time:
      008A9C 52 02            [ 2]  511 	sub	sp, #2
                                    512 ;	driver/ds1302.c: 149: ds1302_write(DS1302_CONTROL_REG,0x00); //关闭写保护 
      008A9E 4B 00            [ 1]  513 	push	#0x00
      008AA0 4B 8E            [ 1]  514 	push	#0x8e
      008AA2 CD 89 9B         [ 4]  515 	call	_ds1302_write
      008AA5 5B 02            [ 2]  516 	addw	sp, #2
                                    517 ;	driver/ds1302.c: 150: ds1302_write(DS1302_SEC_REG,0x80); //暂停 
      008AA7 4B 80            [ 1]  518 	push	#0x80
      008AA9 4B 80            [ 1]  519 	push	#0x80
      008AAB CD 89 9B         [ 4]  520 	call	_ds1302_write
      008AAE 5B 02            [ 2]  521 	addw	sp, #2
                                    522 ;	driver/ds1302.c: 151: ds1302_write(DS1302_CHARGER_REG,0xa9); //涓流充电 
      008AB0 4B A9            [ 1]  523 	push	#0xa9
      008AB2 4B 90            [ 1]  524 	push	#0x90
      008AB4 CD 89 9B         [ 4]  525 	call	_ds1302_write
      008AB7 5B 02            [ 2]  526 	addw	sp, #2
                                    527 ;	driver/ds1302.c: 153: ds1302_write(DS1302_SEC_REG, 0x00);           // 启动振荡器
      008AB9 4B 00            [ 1]  528 	push	#0x00
      008ABB 4B 80            [ 1]  529 	push	#0x80
      008ABD CD 89 9B         [ 4]  530 	call	_ds1302_write
      008AC0 5B 02            [ 2]  531 	addw	sp, #2
                                    532 ;	driver/ds1302.c: 154: ds1302_write(DS1302_YEAR_REG,time->year); //年 
      008AC2 16 05            [ 2]  533 	ldw	y, (0x05, sp)
      008AC4 17 01            [ 2]  534 	ldw	(0x01, sp), y
      008AC6 93               [ 1]  535 	ldw	x, y
      008AC7 F6               [ 1]  536 	ld	a, (x)
      008AC8 88               [ 1]  537 	push	a
      008AC9 4B 8C            [ 1]  538 	push	#0x8c
      008ACB CD 89 9B         [ 4]  539 	call	_ds1302_write
      008ACE 5B 02            [ 2]  540 	addw	sp, #2
                                    541 ;	driver/ds1302.c: 155: ds1302_write(DS1302_MONTH_REG,time->month); //月 
      008AD0 1E 01            [ 2]  542 	ldw	x, (0x01, sp)
      008AD2 E6 01            [ 1]  543 	ld	a, (0x1, x)
      008AD4 88               [ 1]  544 	push	a
      008AD5 4B 88            [ 1]  545 	push	#0x88
      008AD7 CD 89 9B         [ 4]  546 	call	_ds1302_write
      008ADA 5B 02            [ 2]  547 	addw	sp, #2
                                    548 ;	driver/ds1302.c: 156: ds1302_write(DS1302_DATE_REG,time->day); //日 
      008ADC 1E 01            [ 2]  549 	ldw	x, (0x01, sp)
      008ADE E6 02            [ 1]  550 	ld	a, (0x2, x)
      008AE0 88               [ 1]  551 	push	a
      008AE1 4B 86            [ 1]  552 	push	#0x86
      008AE3 CD 89 9B         [ 4]  553 	call	_ds1302_write
      008AE6 5B 02            [ 2]  554 	addw	sp, #2
                                    555 ;	driver/ds1302.c: 157: ds1302_write(DS1302_DAY_REG,time->week); //周 
      008AE8 1E 01            [ 2]  556 	ldw	x, (0x01, sp)
      008AEA E6 03            [ 1]  557 	ld	a, (0x3, x)
      008AEC 88               [ 1]  558 	push	a
      008AED 4B 8A            [ 1]  559 	push	#0x8a
      008AEF CD 89 9B         [ 4]  560 	call	_ds1302_write
      008AF2 5B 02            [ 2]  561 	addw	sp, #2
                                    562 ;	driver/ds1302.c: 158: ds1302_write(DS1302_HR_REG,time->hour); //时 
      008AF4 1E 01            [ 2]  563 	ldw	x, (0x01, sp)
      008AF6 E6 04            [ 1]  564 	ld	a, (0x4, x)
      008AF8 88               [ 1]  565 	push	a
      008AF9 4B 84            [ 1]  566 	push	#0x84
      008AFB CD 89 9B         [ 4]  567 	call	_ds1302_write
      008AFE 5B 02            [ 2]  568 	addw	sp, #2
                                    569 ;	driver/ds1302.c: 159: ds1302_write(DS1302_MIN_REG,time->minute); //分 
      008B00 1E 01            [ 2]  570 	ldw	x, (0x01, sp)
      008B02 E6 05            [ 1]  571 	ld	a, (0x5, x)
      008B04 88               [ 1]  572 	push	a
      008B05 4B 82            [ 1]  573 	push	#0x82
      008B07 CD 89 9B         [ 4]  574 	call	_ds1302_write
      008B0A 5B 02            [ 2]  575 	addw	sp, #2
                                    576 ;	driver/ds1302.c: 160: ds1302_write(DS1302_SEC_REG,time->second); //秒 
      008B0C 1E 01            [ 2]  577 	ldw	x, (0x01, sp)
      008B0E E6 06            [ 1]  578 	ld	a, (0x6, x)
      008B10 88               [ 1]  579 	push	a
      008B11 4B 80            [ 1]  580 	push	#0x80
      008B13 CD 89 9B         [ 4]  581 	call	_ds1302_write
      008B16 5B 02            [ 2]  582 	addw	sp, #2
                                    583 ;	driver/ds1302.c: 161: ds1302_write(DS1302_CONTROL_REG,0x80); //打开写保护 
      008B18 4B 80            [ 1]  584 	push	#0x80
      008B1A 4B 8E            [ 1]  585 	push	#0x8e
      008B1C CD 89 9B         [ 4]  586 	call	_ds1302_write
                                    587 ;	driver/ds1302.c: 162: }
      008B1F 5B 04            [ 2]  588 	addw	sp, #4
      008B21 81               [ 4]  589 	ret
                                    590 ;	driver/ds1302.c: 164: void ds1302_write_ram(unsigned char ram_num,unsigned char dat) 
                                    591 ;	-----------------------------------------
                                    592 ;	 function ds1302_write_ram
                                    593 ;	-----------------------------------------
      008B22                        594 _ds1302_write_ram:
                                    595 ;	driver/ds1302.c: 166: ds1302_write(DS1302_CONTROL_REG,0x00); //关闭写保护 
      008B22 4B 00            [ 1]  596 	push	#0x00
      008B24 4B 8E            [ 1]  597 	push	#0x8e
      008B26 CD 89 9B         [ 4]  598 	call	_ds1302_write
      008B29 5B 02            [ 2]  599 	addw	sp, #2
                                    600 ;	driver/ds1302.c: 167: ds1302_write((DS1302_RAM_REG|(ram_num<<2)),dat);
      008B2B 7B 03            [ 1]  601 	ld	a, (0x03, sp)
      008B2D 48               [ 1]  602 	sll	a
      008B2E 48               [ 1]  603 	sll	a
      008B2F 88               [ 1]  604 	push	a
      008B30 49               [ 1]  605 	rlc	a
      008B31 4F               [ 1]  606 	clr	a
      008B32 A2 00            [ 1]  607 	sbc	a, #0x00
      008B34 84               [ 1]  608 	pop	a
      008B35 AA C0            [ 1]  609 	or	a, #0xc0
      008B37 97               [ 1]  610 	ld	xl, a
      008B38 7B 04            [ 1]  611 	ld	a, (0x04, sp)
      008B3A 88               [ 1]  612 	push	a
      008B3B 9F               [ 1]  613 	ld	a, xl
      008B3C 88               [ 1]  614 	push	a
      008B3D CD 89 9B         [ 4]  615 	call	_ds1302_write
      008B40 5B 02            [ 2]  616 	addw	sp, #2
                                    617 ;	driver/ds1302.c: 168: ds1302_write(DS1302_CONTROL_REG,0x80);
      008B42 4B 80            [ 1]  618 	push	#0x80
      008B44 4B 8E            [ 1]  619 	push	#0x8e
      008B46 CD 89 9B         [ 4]  620 	call	_ds1302_write
      008B49 5B 02            [ 2]  621 	addw	sp, #2
                                    622 ;	driver/ds1302.c: 169: }
      008B4B 81               [ 4]  623 	ret
                                    624 ;	driver/ds1302.c: 171: unsigned char  ds1302_read_ram(unsigned char ram_num) 
                                    625 ;	-----------------------------------------
                                    626 ;	 function ds1302_read_ram
                                    627 ;	-----------------------------------------
      008B4C                        628 _ds1302_read_ram:
                                    629 ;	driver/ds1302.c: 174: ret = ds1302_read((DS1302_RAM_REG|(ram_num<<2)));
      008B4C 7B 03            [ 1]  630 	ld	a, (0x03, sp)
      008B4E 48               [ 1]  631 	sll	a
      008B4F 48               [ 1]  632 	sll	a
      008B50 88               [ 1]  633 	push	a
      008B51 49               [ 1]  634 	rlc	a
      008B52 4F               [ 1]  635 	clr	a
      008B53 A2 00            [ 1]  636 	sbc	a, #0x00
      008B55 84               [ 1]  637 	pop	a
      008B56 AA C0            [ 1]  638 	or	a, #0xc0
      008B58 88               [ 1]  639 	push	a
      008B59 CD 89 D9         [ 4]  640 	call	_ds1302_read
      008B5C 5B 01            [ 2]  641 	addw	sp, #1
                                    642 ;	driver/ds1302.c: 175: return ret;
                                    643 ;	driver/ds1302.c: 176: }
      008B5E 81               [ 4]  644 	ret
                                    645 	.area CODE
                                    646 	.area CONST
                                    647 	.area INITIALIZER
                                    648 	.area CABS (ABS)
